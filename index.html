<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–õ–µ–Ω—É—Ä –≤ —Ä—è–¥</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f5dc; /* –ë–µ–∂–µ–≤—ã–π —Ñ–æ–Ω */
            overflow: hidden;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            height: 100vh;
            width: 100vw;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            height: 100%;
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            width: 100%;
            text-align: center;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #8B4513; /* –ö–æ—Ä–∏—á–Ω–µ–≤—ã–π —Ü–≤–µ—Ç */
            color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .score-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 10px;
        }

        .score-box, .timer-box {
            background-color: #deb887; /* –ü–µ—Å–æ—á–Ω—ã–π —Ü–≤–µ—Ç */
            border: 2px solid #8B4513;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            flex: 1;
            text-align: center;
            margin: 0 5px;
        }

        .board-container {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
        }

        #board {
            display: grid;
            position: relative;
            background-color: rgba(139, 69, 19, 0.2);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            touch-action: none;
        }

        #board div {
            background-size: cover;
            background-position: center;
            border-radius: 8px;
            margin: 2px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }

        #board div.selected {
            transform: scale(1.1);
            box-shadow: 0 0 10px #ffcc00, 0 0 20px #ffcc00;
            z-index: 10;
        }

        #board div.appearing {
            animation: appear 0.3s ease-out;
        }

        #board div.disappearing {
            animation: disappear 0.3s ease-in;
        }

        #board div.falling {
            animation: fall 0.3s ease-in;
        }

        @keyframes appear {
            from { opacity: 0; transform: scale(0); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes disappear {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0); }
        }

        @keyframes fall {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }

        #reset-button {
            background-color: #8B4513;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s;
            margin: 10px 0;
        }

        #reset-button:hover, #reset-button:active {
            background-color: #6b3510;
        }

        .controls {
            width: 100%;
            display: flex;
            justify-content: center;
        }

        .instructions {
            margin-top: 15px;
            text-align: center;
            font-size: 14px;
            color: #6b3510;
            padding: 10px;
            background-color: rgba(222, 184, 135, 0.5);
            border-radius: 8px;
        }

        /* –î–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏ */
        .timer-progress {
            width: 100%;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
        }

        .timer-bar {
            height: 100%;
            background-color: #8B4513;
            transition: width 1s linear;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ */
        @media (max-height: 600px) {
            .header {
                padding: 5px;
                margin-bottom: 5px;
            }
            .score-container {
                margin-bottom: 5px;
            }
            .board-container {
                margin-bottom: 5px;
            }
            .instructions {
                margin-top: 5px;
                padding: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>–õ–µ–Ω—É—Ä —Ç—Ä–∏ –≤ —Ä—è–¥</h1>
        </div>
        
        <div class="score-container">
            <div class="score-box">
                <div id="score">–û—á–∫–∏: 0</div>
            </div>
            <div class="timer-box">
                <div id="timer">–í—Ä–µ–º—è: 60 —Å–µ–∫—É–Ω–¥</div>
                <div class="timer-progress">
                    <div class="timer-bar" id="timer-bar"></div>
                </div>
            </div>
        </div>
        
        <div class="board-container">
            <div id="board"></div>
        </div>
        
        <div class="controls">
            <button id="reset-button">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
        </div>
        
        <div class="instructions">
            –õ–µ–Ω—É—Ä —Å–ª–µ–¥–∏—Ç –∑–∞ —Ç–æ–±–æ–π        </div>
    </div>

    <script>

// –î–æ–±–∞–≤—å—Ç–µ –≤ –Ω–∞—á–∞–ª–æ –∏–≥—Ä—ã –∏–ª–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('touchstart', function initAudio() {
    // –ü—ã—Ç–∞–µ–º—Å—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∏ —Å—Ä–∞–∑—É –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–≤—É–∫, —á—Ç–æ–±—ã "—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å" –∞—É–¥–∏–æ
    const silentSound = new Audio();
    silentSound.play().then(() => {
        silentSound.pause();
        silentSound.currentTime = 0;
        
        // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –∑–≤—É–∫–∏
        [startSound, endSound, fiveLinesSound, backgroundMusic, matchSound, swapSound].forEach(sound => {
            sound.load();
        });
        
        console.log('Audio initialized');
    }).catch(e => console.log('Could not initialize audio:', e));
    
    // –£–±–∏—Ä–∞–µ–º —ç—Ç–æ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
    document.removeEventListener('touchstart', initAudio);
}, { once: true });
// –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞
function playSound(sound) {
    if (sound && sound.readyState >= 2) {
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º Promise –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
        return sound.play().catch(e => {
            console.log('Error playing sound:', e);
            // –ï—Å–ª–∏ –∑–≤—É–∫ –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–ª—Å—è, –º–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –µ–≥–æ —Å–Ω–æ–≤–∞
            sound.load();
        });
    }
    return Promise.resolve(); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º Promise, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫
}

// –î–æ–±–∞–≤—å—Ç–µ HTML –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–≤—É–∫–∞
const soundIndicator = document.createElement('div');
soundIndicator.innerHTML = 'üîá'; // –ò–∫–æ–Ω–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–≥–æ –∑–≤—É–∫–∞
soundIndicator.style = 'position: absolute; top: 10px; right: 10px; font-size: 24px; cursor: pointer;';
document.body.appendChild(soundIndicator);

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è –∑–≤—É–∫–∞
soundIndicator.addEventListener('click', function() {
    if (backgroundMusic.paused) {
        // –í–∫–ª—é—á–∞–µ–º –∑–≤—É–∫
        backgroundMusic.play().then(() => {
            soundIndicator.innerHTML = 'üîä'; // –ò–∫–æ–Ω–∫–∞ –≤–∫–ª—é—á–µ–Ω–Ω–æ–≥–æ –∑–≤—É–∫–∞
        }).catch(e => console.log('Error enabling sound:', e));
    } else {
        // –í—ã–∫–ª—é—á–∞–µ–º –∑–≤—É–∫
        backgroundMusic.pause();
        soundIndicator.innerHTML = 'üîá'; // –ò–∫–æ–Ω–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–≥–æ –∑–≤—É–∫–∞
    }
});

        const boardSize = 8;  // –†–∞–∑–º–µ—Ä –¥–æ—Å–∫–∏
        const maxBlockSize = 60;  // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞
        const blockImages = [
            'bomb.jpg',   // –ë–æ–º–±–∞
            'drova.jpg',  // –î—Ä–æ–≤–∞
            'tractor.jpg',  // –¢—Ä–∞–∫—Ç–æ—Ä
            'pivo.jpg',  // –ü–∏–≤–æ
            'spil.png',  // –°–ø–∏–ª
        ];

        const board = document.getElementById('board');
        const resetButton = document.getElementById('reset-button');
        const scoreDisplay = document.getElementById('score');
        const timerDisplay = document.getElementById('timer');
        const timerBar = document.getElementById('timer-bar');

        // –ó–≤—É–∫–∏
        const startSound = new Audio('start_game.mp3');  // –ó–≤—É–∫ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã
        const endSound = new Audio('end_game.mp3');  // –ó–≤—É–∫ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
        const fiveLinesSound = new Audio('five_lines.mp3');  // –ó–≤—É–∫ –ø—Ä–∏ —Å–∂–∏–≥–∞–Ω–∏–∏ 5 –ª–∏–Ω–∏–π
        const backgroundMusic = new Audio('background_music.mp3');  // –§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞
        const matchSound = new Audio('match.mp3'); // –ó–≤—É–∫ –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏
        const swapSound = new Audio('swap.mp3'); // –ó–≤—É–∫ –ø—Ä–∏ –æ–±–º–µ–Ω–µ

        // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        function preloadImages() {
            blockImages.forEach(image => {
                const img = new Image();
                img.src = image;
            });
        }

        let gameBoard = [];
        let selectedBlock = null;
        let score = 0;
        let timerInterval;
        let timeLeft = 60; // –í—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
        let initialTime = 60; // –ò—Å—Ö–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏
        let touchStartX, touchStartY; // –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–≤–∞–π–ø–æ–≤
        let isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        function calculateBlockSize() {
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–µ–Ω—å—à–µ–µ –∏–∑ –∏–∑–º–µ—Ä–µ–Ω–∏–π –¥–ª—è –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–π –¥–æ—Å–∫–∏
            const availableSpace = Math.min(screenWidth * 0.95, screenHeight * 0.6);
            
            // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–º–µ—Ä –æ–¥–Ω–æ–≥–æ –±–ª–æ–∫–∞ (—Å —É—á–µ—Ç–æ–º –æ—Ç—Å—Ç—É–ø–æ–≤)
            const blockSize = Math.floor(availableSpace / boardSize) - 4;
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞
            return Math.min(blockSize, maxBlockSize);
        }

        function addAnimationEndListener(element, className) {
            element.addEventListener('animationend', function() {
                element.classList.remove(className);
            }, { once: true });
        }

        function generateBoard() {
            gameBoard = [];
            board.innerHTML = '';
            const blockSize = calculateBlockSize();
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —Å–µ—Ç–∫–∏
            board.style.gridTemplateColumns = `repeat(${boardSize}, ${blockSize}px)`;
            board.style.gridTemplateRows = `repeat(${boardSize}, ${blockSize}px)`;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–æ—Å–∫—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
            for (let i = 0; i < boardSize; i++) {
                const row = [];
                for (let j = 0; j < boardSize; j++) {
                    const randomImage = blockImages[Math.floor(Math.random() * blockImages.length)];
                    row.push(randomImage);
                    
                    const cell = document.createElement('div');
                    cell.style.width = `${blockSize}px`;
                    cell.style.height = `${blockSize}px`;
                    cell.style.backgroundImage = `url(${randomImage})`;
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    cell.classList.add('appearing');
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–∞—Å–∞–Ω–∏–π/–∫–ª–∏–∫–æ–≤
                    if (isTouchDevice) {
                        cell.addEventListener('touchstart', handleTouchStart);
                        cell.addEventListener('touchend', (e) => handleTouchEnd(e, i, j, cell));
                    } else {
                        cell.addEventListener('click', () => handleBlockClick(i, j, cell));
                    }
                    
                    board.appendChild(cell);
                    addAnimationEndListener(cell, 'appearing');
                }
                gameBoard.push(row);
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
            checkAndResolveInitialMatches();
        }

        function checkAndResolveInitialMatches() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –∏ –∑–∞–º–µ–Ω—è–µ–º –∫–∞—Ä—Ç–∏–Ω–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
            let hasMatches = true;
            let iterations = 0;
            const MAX_ITERATIONS = 5; // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π
            
            while (hasMatches && iterations < MAX_ITERATIONS) {
                iterations++;
                let matchFound = false;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
                for (let row = 0; row < boardSize; row++) {
                    for (let col = 0; col < boardSize - 2; col++) {
                        const image = gameBoard[row][col];
                        if (image && gameBoard[row][col + 1] === image && gameBoard[row][col + 2] === image) {
                            // –ó–∞–º–µ–Ω—è–µ–º –æ–¥–∏–Ω –∏–∑ –±–ª–æ–∫–æ–≤
                            let newImage;
                            do {
                                newImage = blockImages[Math.floor(Math.random() * blockImages.length)];
                            } while (newImage === image);
                            
                            gameBoard[row][col + 1] = newImage;
                            const cellIndex = row * boardSize + (col + 1);
                            board.children[cellIndex].style.backgroundImage = `url(${newImage})`;
                            matchFound = true;
                        }
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
                for (let col = 0; col < boardSize; col++) {
                    for (let row = 0; row < boardSize - 2; row++) {
                        const image = gameBoard[row][col];
                        if (image && gameBoard[row + 1][col] === image && gameBoard[row + 2][col] === image) {
                            // –ó–∞–º–µ–Ω—è–µ–º –æ–¥–∏–Ω –∏–∑ –±–ª–æ–∫–æ–≤
                            let newImage;
                            do {
                                newImage = blockImages[Math.floor(Math.random() * blockImages.length)];
                            } while (newImage === image);
                            
                            gameBoard[row + 1][col] = newImage;
                            const cellIndex = (row + 1) * boardSize + col;
                            board.children[cellIndex].style.backgroundImage = `url(${newImage})`;
                            matchFound = true;
                        }
                    }
                }
                
                hasMatches = matchFound;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞—á–∞–ª–∞ –∫–∞—Å–∞–Ω–∏—è
        function handleTouchStart(e) {
            e.preventDefault();
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫–∞—Å–∞–Ω–∏—è
        function handleTouchEnd(e, row, col, cell) {
            e.preventDefault();
            if (!touchStartX || !touchStartY) return;
            
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            
            const diffX = touchEndX - touchStartX;
            const diffY = touchEndY - touchStartY;
            const minSwipeDistance = 30; // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è —Å–≤–∞–π–ø–∞
            
            // –ï—Å–ª–∏ —ç—Ç–æ –∫–æ—Ä–æ—Ç–∫–æ–µ –∫–∞—Å–∞–Ω–∏–µ, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –∫–ª–∏–∫
            if (Math.abs(diffX) < minSwipeDistance && Math.abs(diffY) < minSwipeDistance) {
                handleBlockClick(row, col, cell);
                return;
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–∞–π–ø–∞
            if (Math.abs(diffX) > Math.abs(diffY)) {
                // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
                if (diffX > 0 && col < boardSize - 1) {
                    // –°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ
                    swapByDirection(row, col, 0, 1);
                } else if (diffX < 0 && col > 0) {
                    // –°–≤–∞–π–ø –≤–ª–µ–≤–æ
                    swapByDirection(row, col, 0, -1);
                }
            } else {
                // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
                if (diffY > 0 && row < boardSize - 1) {
                    // –°–≤–∞–π–ø –≤–Ω–∏–∑
                    swapByDirection(row, col, 1, 0);
                } else if (diffY < 0 && row > 0) {
                    // –°–≤–∞–π–ø –≤–≤–µ—Ä—Ö
                    swapByDirection(row, col, -1, 0);
                }
            }
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞—á–∞–ª–∞ –∫–∞—Å–∞–Ω–∏—è
            touchStartX = null;
            touchStartY = null;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–º–µ–Ω–∞ –±–ª–æ–∫–æ–≤ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é
        function swapByDirection(row, col, rowDiff, colDiff) {
            swapBlocks(row, col, row + rowDiff, col + colDiff);
            if (!checkMatches()) {
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –±–ª–æ–∫–∏ –Ω–∞ –º–µ—Å—Ç–æ, –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
                setTimeout(() => {
                    swapBlocks(row + rowDiff, col + colDiff, row, col);
                }, 500);
            } else {
                setTimeout(() => refillBoard(), 500);
            }
        }

        function handleBlockClick(row, col, cell) {
            // –ï—Å–ª–∏ –±–ª–æ–∫ —É–∂–µ –≤—ã–±—Ä–∞–Ω, –æ—Ç–º–µ–Ω—è–µ–º –≤—ã–±–æ—Ä
            if (selectedBlock && selectedBlock.row === row && selectedBlock.col === col) {
                cell.classList.remove('selected');
                selectedBlock = null;
                return;
            }

            // –ï—Å–ª–∏ —É–∂–µ –≤—ã–±—Ä–∞–Ω –¥—Ä—É–≥–æ–π –±–ª–æ–∫
            if (selectedBlock) {
                const dx = Math.abs(selectedBlock.row - row);
                const dy = Math.abs(selectedBlock.col - col);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –±–ª–æ–∫–∏ —Å–æ—Å–µ–¥–Ω–∏–µ
                if ((dx === 1 && dy === 0) || (dx === 0 && dy === 1)) {
                    swapBlocks(selectedBlock.row, selectedBlock.col, row, col);
                    if (!checkMatches()) {
                        // –ï—Å–ª–∏ –Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –±–ª–æ–∫–∏ –æ–±—Ä–∞—Ç–Ω–æ
                        setTimeout(() => {
                            swapBlocks(row, col, selectedBlock.row, selectedBlock.col);
                        }, 500);
                    } else {
                        // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è, –∑–∞–ø–æ–ª–Ω—è–µ–º –ø—É—Å—Ç—ã–µ –º–µ—Å—Ç–∞
                        setTimeout(() => refillBoard(), 500);
                    }
                }
                
                // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –±–ª–æ–∫–∞
                board.children[selectedBlock.row * boardSize + selectedBlock.col].classList.remove('selected');
                selectedBlock = null;
            } else {
                // –í—ã–±–∏—Ä–∞–µ–º —Ç–µ–∫—É—â–∏–π –±–ª–æ–∫
                selectedBlock = { row, col, cell };
                cell.classList.add('selected');
            }
        }

        function swapBlocks(row1, col1, row2, col2) {
            // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫ –æ–±–º–µ–Ω–∞
            if (swapSound.readyState >= 2) { // 2 = HAVE_CURRENT_DATA
                swapSound.currentTime = 0;
                swapSound.play().catch(e => console.log('Error playing swap sound:', e));
            }
            
            // –ú–µ–Ω—è–µ–º –±–ª–æ–∫–∏ –≤ –º–∞—Å—Å–∏–≤–µ
            [gameBoard[row1][col1], gameBoard[row2][col2]] = [gameBoard[row2][col2], gameBoard[row1][col1]];
            
            // –ú–µ–Ω—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–ª–æ–∫–æ–≤
            const cell1 = board.children[row1 * boardSize + col1];
            const cell2 = board.children[row2 * boardSize + col2];
            
            [cell1.style.backgroundImage, cell2.style.backgroundImage] = 
                [cell2.style.backgroundImage, cell1.style.backgroundImage];
        }

        function checkMatches() {
            let matches = [];
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
            for (let row = 0; row < boardSize; row++) {
                for (let col = 0; col < boardSize - 2; col++) {
                    const image = gameBoard[row][col];
                    if (image && gameBoard[row][col + 1] === image && gameBoard[row][col + 2] === image) {
                        matches.push([[row, col], [row, col + 1], [row, col + 2]]);
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ 4 –≤ —Ä—è–¥
                        if (col < boardSize - 3 && gameBoard[row][col + 3] === image) {
                            matches[matches.length - 1].push([row, col + 3]);
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ 5 –≤ —Ä—è–¥
                            if (col < boardSize - 4 && gameBoard[row][col + 4] === image) {
                                matches[matches.length - 1].push([row, col + 4]);
                            }
                        }
                    }
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
            for (let col = 0; col < boardSize; col++) {
                for (let row = 0; row < boardSize - 2; row++) {
                    const image = gameBoard[row][col];
                    if (image && gameBoard[row + 1][col] === image && gameBoard[row + 2][col] === image) {
                        matches.push([[row, col], [row + 1, col], [row + 2, col]]);
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ 4 –≤ —Ä—è–¥
                        if (row < boardSize - 3 && gameBoard[row + 3][col] === image) {
                            matches[matches.length - 1].push([row + 3, col]);
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ 5 –≤ —Ä—è–¥
                            if (row < boardSize - 4 && gameBoard[row + 4][col] === image) {
                                matches[matches.length - 1].push([row + 4, col]);
                            }
                        }
                    }
                }
            }
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
            if (matches.length > 0) {
                // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
                if (matchSound.readyState >= 2) {
                    matchSound.currentTime = 0;
                    matchSound.play().catch(e => console.log('Error playing match sound:', e));
                }
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
                matches.flat().forEach(([r, c]) => {
                    gameBoard[r][c] = null;
                    let cell = board.children[r * boardSize + c];
                    cell.classList.add('disappearing');
                    addAnimationEndListener(cell, 'disappearing');
                    setTimeout(() => cell.style.backgroundImage = '', 500);
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç
                updateScore(matches);
                
                // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∑–≤—É–∫ –ø—Ä–∏ 5 –∏ –±–æ–ª–µ–µ –ª–∏–Ω–∏—è—Ö
                if (matches.length >= 5 && fiveLinesSound.readyState >= 2) {
                    fiveLinesSound.currentTime = 0;
                    fiveLinesSound.play().catch(e => console.log('Error playing five lines sound:', e));
                }
                
                setTimeout(refillBoard, 600);
                return true;
            }
            
            return false;
        }

        function refillBoard() {
            // –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞
            for (let col = 0; col < boardSize; col++) {
                let emptyCells = [];
                
                // –°–æ–±–∏—Ä–∞–µ–º –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏, –Ω–∞—á–∏–Ω–∞—è —Å–Ω–∏–∑—É
                for (let row = boardSize - 1; row >= 0; row--) {
                    if (gameBoard[row][col] === null) {
                        emptyCells.push(row);
                    } else if (emptyCells.length > 0) {
                        // –ï—Å–ª–∏ –Ω–∞—à–ª–∏ –Ω–µ–ø—É—Å—Ç—É—é —è—á–µ–π–∫—É –∏ –µ—Å—Ç—å –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –Ω–∏–∂–µ
                        let newRow = emptyCells.shift();
                        gameBoard[newRow][col] = gameBoard[row][col];
                        gameBoard[row][col] = null;
                        
                        let cell = board.children[newRow * boardSize + col];
                        cell.style.backgroundImage = board.children[row * boardSize + col].style.backgroundImage;
                        cell.classList.add('falling');
                        addAnimationEndListener(cell, 'falling');
                        
                        board.children[row * boardSize + col].style.backgroundImage = '';
                        emptyCells.push(row);
                    }
                }
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –Ω–æ–≤—ã–º–∏ —Å–ª—É—á–∞–π–Ω—ã–º–∏ –±–ª–æ–∫–∞–º–∏
                emptyCells.forEach(row => {
                    const randomImage = blockImages[Math.floor(Math.random() * blockImages.length)];
                    gameBoard[row][col] = randomImage;
                    
                    let cell = board.children[row * boardSize + col];
                    cell.style.backgroundImage = `url(${randomImage})`;
                    cell.classList.add('appearing');
                    addAnimationEndListener(cell, 'appearing');
                });
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
            setTimeout(checkMatches, 600);
        }

        function updateScore(matches) {
            // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –æ—á–∫–∏ —Å –±–æ–Ω—É—Å–∞–º–∏ –∑–∞ –±–æ–ª—å—à–∏–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
            let scoreIncrease = matches.reduce((sum, match) => {
                if (match.length === 3) return sum + 10;       // 3 –≤ —Ä—è–¥ = 10 –æ—á–∫–æ–≤
                else if (match.length === 4) return sum + 20;  // 4 –≤ —Ä—è–¥ = 20 –æ—á–∫–æ–≤
                else return sum + 50;                          // 5 –≤ —Ä—è–¥ = 50 –æ—á–∫–æ–≤
            }, 0);
            
            // –ë–æ–Ω—É—Å –∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π —Å—Ä–∞–∑—É
            if (matches.length > 1) {
                scoreIncrease = Math.floor(scoreIncrease * (1 + 0.1 * (matches.length - 1)));
            }
            
            score += scoreIncrease;
            scoreDisplay.textContent = `–û—á–∫–∏: ${score}`;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è –∑–∞ –∫–æ–º–±–æ
            if (matches.length >= 2) {
                addBonusTime(matches.length * 2); // 2 —Å–µ–∫—É–Ω–¥—ã –∑–∞ –∫–∞–∂–¥–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
            }
        }

        function addBonusTime(seconds) {
            timeLeft = Math.min(timeLeft + seconds, initialTime);
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            timerDisplay.textContent = `–í—Ä–µ–º—è: ${timeLeft} —Å–µ–∫—É–Ω–¥`;
            const percentage = (timeLeft / initialTime) * 100;
            timerBar.style.width = `${percentage}%`;
            
            // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏
            if (percentage > 60) {
                timerBar.style.backgroundColor = '#8B4513'; // –ö–æ—Ä–∏—á–Ω–µ–≤—ã–π
            } else if (percentage > 30) {
                timerBar.style.backgroundColor = '#DAA520'; // –ó–æ–ª–æ—Ç–∏—Å—Ç—ã–π
            } else {
                timerBar.style.backgroundColor = '#B22222'; // –ö—Ä–∞—Å–Ω—ã–π
            }
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    updateTimerDisplay();
                } else {
                    clearInterval(timerInterval);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫—Ä–∞—Å–∏–≤—ã–º –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
                    showGameOverModal();
                    
                    // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
                    if (endSound.readyState >= 2) {
                        endSound.play().catch(e => console.log('Error playing end sound:', e));
                    }
                    
                    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É
                    backgroundMusic.pause();
                    disableGame();
                }
            }, 1000);
        }

        function showGameOverModal() {
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
            modal.style.display = 'flex';
            modal.style.justifyContent = 'center';
            modal.style.alignItems = 'center';
            modal.style.zIndex = '1000';
            
            const modalContent = document.createElement('div');
            modalContent.style.backgroundColor = '#f5f5dc';
            modalContent.style.padding = '20px';
            modalContent.style.borderRadius = '10px';
            modalContent.style.boxShadow = '0 0 20px rgba(0, 0, 0, 0.5)';
            modalContent.style.textAlign = 'center';
            modalContent.style.maxWidth = '80%';
            
            const title = document.createElement('h2');
            title.textContent = '–í—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æ!';
            title.style.color = '#8B4513';
            title.style.marginBottom = '10px';
            
            const scoreText = document.createElement('p');
            scoreText.textContent = `–í—ã –Ω–∞–±—Ä–∞–ª–∏ ${score} –æ—á–∫–æ–≤`;
            scoreText.style.fontSize = '18px';
            scoreText.style.marginBottom = '20px';
            
            const button = document.createElement('button');
            button.textContent = '–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞';
            button.style.backgroundColor = '#8B4513';
            button.style.color = 'white';
            button.style.border = 'none';
            button.style.padding = '10px 20px';
            button.style.borderRadius = '5px';
            button.style.cursor = 'pointer';
            
            button.addEventListener('click', () => {
                document.body.removeChild(modal);
                resetGame();
            });
            
            modalContent.appendChild(title);
            modalContent.appendChild(scoreText);
            modalContent.appendChild(button);
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
        }

      function disableGame() {
    const cells = board.querySelectorAll('div');
    cells.forEach(cell => {
        cell.style.pointerEvents = 'none'; // –û—Ç–∫–ª—é—á–∞–µ–º –∫–ª–∏–∫–∏ –ø–æ —è—á–µ–π–∫–∞–º
    });
    
    resetButton.textContent = '–ù–æ–≤–∞—è –∏–≥—Ä–∞';
    resetButton.style.animation = 'pulse 1s infinite';
}

function resetGame() {
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    selectedBlock = null;
    score = 0;
    timeLeft = initialTime = 60;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    scoreDisplay.textContent = `–û—á–∫–∏: ${score}`;
    updateTimerDisplay();
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—É—é –¥–æ—Å–∫—É
    generateBoard();
    
    // –í–∫–ª—é—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –¥–æ—Å–∫–∏
    const cells = board.querySelectorAll('div');
    cells.forEach(cell => {
        cell.style.pointerEvents = 'auto';
    });
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
    resetButton.textContent = '–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ';
    resetButton.style.animation = '';
    
    // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
    startTimer();
    
    // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã
    if (startSound.readyState >= 2) {
        startSound.play().catch(e => console.log('Error playing start sound:', e));
    }
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É
    if (backgroundMusic.readyState >= 2) {
        backgroundMusic.currentTime = 0;
        backgroundMusic.loop = true;
        backgroundMusic.volume = 0.5;
        backgroundMusic.play().catch(e => console.log('Error playing background music:', e));
    }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
window.addEventListener('resize', () => {
    const blockSize = calculateBlockSize();
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —Å–µ—Ç–∫–∏
    board.style.gridTemplateColumns = `repeat(${boardSize}, ${blockSize}px)`;
    board.style.gridTemplateRows = `repeat(${boardSize}, ${blockSize}px)`;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä –≤—Å–µ—Ö —è—á–µ–µ–∫
    const cells = board.querySelectorAll('div');
    cells.forEach(cell => {
        cell.style.width = `${blockSize}px`;
        cell.style.height = `${blockSize}px`;
    });
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å–±—Ä–æ—Å–∞
resetButton.addEventListener('click', resetGame);

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
preloadImages();
generateBoard();
resetGame();

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É –≥—Ä–æ–º–∫–æ—Å—Ç–∏
document.addEventListener('keydown', function(event) {
    // M - –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É
    if (event.key === 'm' || event.key === '–º' || event.key === 'M' || event.key === '–ú') {
        if (backgroundMusic.paused) {
            backgroundMusic.play().catch(e => console.log('Error playing background music:', e));
        } else {
            backgroundMusic.pause();
        }
    }
});

// –î–æ–±–∞–≤–ª—è–µ–º CSS-–∞–Ω–∏–º–∞—Ü–∏—é –¥–ª—è –∫–Ω–æ–ø–∫–∏
document.head.insertAdjacentHTML('beforeend', `
    <style>
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
`);

// –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å–∫—Ä–æ–ª–ª –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –ø—Ä–∏ —Å–≤–∞–π–ø–∞—Ö
document.addEventListener('touchmove', function(e) {
    if (e.target.closest('#board')) {
        e.preventDefault();
    }
}, { passive: false });

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∑–≤—É–∫–æ–≤ –∏ –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –∏—Ö
function setupSounds() {
    const sounds = [startSound, endSound, fiveLinesSound, backgroundMusic, matchSound, swapSound];
    
    sounds.forEach(sound => {
        // –ï—Å–ª–∏ –∑–≤—É–∫ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏
        if (sound.readyState < 2) {
            sound.addEventListener('canplaythrough', () => {
                console.log('Sound loaded:', sound.src);
            });
            
            sound.addEventListener('error', (e) => {
                console.warn('Error loading sound:', e);
            });
        }
    });
}

// –í—ã–∑—ã–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∑–≤—É–∫–æ–≤
setupSounds();

// –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤
function checkPossibleMoves() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å–≤–∞–ø—ã
    for (let row = 0; row < boardSize; row++) {
        for (let col = 0; col < boardSize - 1; col++) {
            // –í—Ä–µ–º–µ–Ω–Ω–æ –º–µ–Ω—è–µ–º –±–ª–æ–∫–∏
            [gameBoard[row][col], gameBoard[row][col + 1]] = [gameBoard[row][col + 1], gameBoard[row][col]];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
            if (checkForPotentialMatches()) {
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –±–ª–æ–∫–∏ –Ω–∞ –º–µ—Å—Ç–æ
                [gameBoard[row][col], gameBoard[row][col + 1]] = [gameBoard[row][col + 1], gameBoard[row][col]];
                return true;
            }
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –±–ª–æ–∫–∏ –Ω–∞ –º–µ—Å—Ç–æ
            [gameBoard[row][col], gameBoard[row][col + 1]] = [gameBoard[row][col + 1], gameBoard[row][col]];
        }
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Å–≤–∞–ø—ã
    for (let col = 0; col < boardSize; col++) {
        for (let row = 0; row < boardSize - 1; row++) {
            // –í—Ä–µ–º–µ–Ω–Ω–æ –º–µ–Ω—è–µ–º –±–ª–æ–∫–∏
            [gameBoard[row][col], gameBoard[row + 1][col]] = [gameBoard[row + 1][col], gameBoard[row][col]];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
            if (checkForPotentialMatches()) {
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –±–ª–æ–∫–∏ –Ω–∞ –º–µ—Å—Ç–æ
                [gameBoard[row][col], gameBoard[row + 1][col]] = [gameBoard[row + 1][col], gameBoard[row][col]];
                return true;
            }
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –±–ª–æ–∫–∏ –Ω–∞ –º–µ—Å—Ç–æ
            [gameBoard[row][col], gameBoard[row + 1][col]] = [gameBoard[row + 1][col], gameBoard[row][col]];
        }
    }
    
    // –ï—Å–ª–∏ –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º false
    return false;
}

// –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π 
function checkForPotentialMatches() {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
    for (let row = 0; row < boardSize; row++) {
        for (let col = 0; col < boardSize - 2; col++) {
            const image = gameBoard[row][col];
            if (image && gameBoard[row][col + 1] === image && gameBoard[row][col + 2] === image) {
                return true;
            }
        }
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
    for (let col = 0; col < boardSize; col++) {
        for (let row = 0; row < boardSize - 2; row++) {
            const image = gameBoard[row][col];
            if (image && gameBoard[row + 1][col] === image && gameBoard[row + 2][col] === image) {
                return true;
            }
        }
    }
    
    return false;
}

// –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è –¥–æ—Å–∫–∏, –µ—Å–ª–∏ –Ω–µ—Ç —Ö–æ–¥–æ–≤
function shuffleBoard() {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–∏
    const message = document.createElement('div');
    message.textContent = '–ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ...';
    message.style.position = 'absolute';
    message.style.top = '50%';
    message.style.left = '50%';
    message.style.transform = 'translate(-50%, -50%)';
    message.style.backgroundColor = 'rgba(139, 69, 19, 0.8)';
    message.style.color = 'white';
    message.style.padding = '10px 20px';
    message.style.borderRadius = '5px';
    message.style.zIndex = '100';
    message.style.fontWeight = 'bold';
    board.appendChild(message);
    
    // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    setTimeout(() => {
        for (let row = 0; row < boardSize; row++) {
            for (let col = 0; col < boardSize; col++) {
                const randomImage = blockImages[Math.floor(Math.random() * blockImages.length)];
                gameBoard[row][col] = randomImage;
                board.children[row * boardSize + col].style.backgroundImage = `url(${randomImage})`;
                board.children[row * boardSize + col].classList.add('appearing');
                addAnimationEndListener(board.children[row * boardSize + col], 'appearing');
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è
        checkAndResolveInitialMatches();
        
        // –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        board.removeChild(message);
    }, 1000);
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ö–æ–¥–æ–≤ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
setInterval(() => {
    if (!checkPossibleMoves() && timeLeft > 0) {
        shuffleBoard();
    }
}, 2000);
</script>
</body>
</html>
